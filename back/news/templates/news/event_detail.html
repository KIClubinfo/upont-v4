{% load static %}
<!--Header-->
{% include "header.html" with title="Détails de l'évènement" %}

    <!--Body-->
    <body>
        <!--Feedback Button-->
        {% include "feedback.html" %}

        <!--Sidenav-->
        {% include "sidenav.html" with active_link="news" %}

        <!--Content-->
        <div class="content">
            <div class="content-header">
                <div class="row justify-content-between w-100">
                    <div class="col">
                        <div class="search-input-group">
                            <input type="text" class="search-input" placeholder="Rechercher">
                            <button class="button search-button"><i class="fas fa-search "></i></button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="content-main">
                <h3 class="page-title">News : Events : {{event.name}}</h3>
                <div class="row">
                    {% if event_posts %}
                        <div class="col-lg-6">
                            {% if is_member %}
                                <div class="mt-2" style="text-align:center">
                                    <a href="{% url 'news:post_create' %}"><i class="fas fa-plus-circle fa-5x"></i></a>
                                    <br> <br>
                                    <h5> Ajouter un post </h5>
                                </div>
                            {% endif %}
                            {% for post in event_posts %}
                            <div class="news-card">
                                <div class="news-card-header">
                                    <!--Poster-Image-Name-and-Title-of-the-post-->
                                    {% if post.club %}
                                        {% if post.club.logo %}
                                            <div class="news-card-header-image"><img src="{{post.club.logo.url}}"></div>
                                        {% endif %}
                                    {% else %}
                                        {% if post.author.picture %}
                                            <div class="news-card-header-image"><img src="{{post.author.picture.url}}"></div>
                                        {% endif %}
                                    {% endif %}
                                    <div class="news-card-header-text">
                                        <span class="news-card-header-name">
                                            {%if post.club%}
                                                {{post.club.name}}
                                            {%else%}
                                                {{post.author.user.first_name}} {{post.author.user.last_name}}
                                            {%endif%}
                                        </span>
                                        {% if post.event %}
                                            <a href="{% url 'news:event_detail' post.event.pk %}" class="news-card-header-title">{{post.title}}</a>
                                        {% else %}
                                            <span class="news-card-header-title">{{post.title}}</span>
                                        {% endif %}
                                    </div>
                                    {% if is_member %}
                                        <a href="{% url 'news:post_edit' post.id %}?next=event_edit" class="button blue-button">Éditer</a>
                                    {% endif %}
                                </div>
                                <div class="news-card-content">
                                    <p>{{post.content}}</p>
                                </div>
                                {%if post.illustration%}
                                <div class="news-card-images">
                                        <!--All-Images-Linked-With-The-Post-->
                                        <div class="news-card-carousel" data-flickity='{}'>
                                            <div class="carousel-cell"><img src="{{post.illustration.url}}" style="height: 100%;" alt=""></div>
                                        </div>
                                    </div>
                                {%endif%}
                                <div class="news-card-actions">
                                    <!--Likes-Comments-Favorite-->
                                    <div class="news-card-buttons">
                                        {% if user.student in post.likes.all  %}
                                            <a href="{% url 'news:post_like' post_id=post.id action='Dislike'%}" class="news-card-button"><i class="fas fa-heart"></i></a>
                                        {% else %}
                                            <a href="{% url 'news:post_like' post_id=post.id action='Like'%}" class="news-card-button"><i class="far fa-heart"></i></a>
                                        {% endif %}
                                    </div>
                                    <div class="news-card-popularity">
                                        <span><i class="fas fa-heart" style="color: red;"></i> {{post.total_likes}}</span>
                                        <span><i class="fas fa-comment" style="color: rgb(0, 153, 255);"></i> {{ post.total_comments }}</span>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        <div class="col-lg-6">
                    {% else %}
                        {% if is_member %}
                            <div class="col-lg-6">
                                <div class="mt-2" style="text-align:center">
                                    <a href="{% url 'news:post_create' %}"><i class="fas fa-plus-circle fa-5x"></i></a>
                                    <br> <br>
                                    <h5> Ajouter un post </h5>
                                </div>
                            </div>
                            <div class="col-lg-6">
                        {% else %}
                            <div class="col-lg-12">
                        {% endif %}
                    {% endif %}
                        <div class="box mt-3">
                            <div class="section-title">Information concernant l'évènement : {{event.name}}</div>
                            <p class="mt-3"><strong>Date de l'évènement :</strong> {{event.date}}</p>
                            <p><strong>Qui organise ?</strong> {{event.club}}</p>
                            <p><strong>Où ?</strong> {{event.location}}</p>
                            <p><strong>Description de l'évènement :</strong> {{event.description}}</p>
                            {% if event.shotgun %}
                                <p><strong>Shotgun :</strong> Cet évènement est soumis à un shotgun
                                {% if event.shotgun.requires_motivation %} avec {% else %} sans {% endif %} motivation.
                                    Il commence le {{event.shotgun.starting_date}} et finit le {{event.shotgun.ending_date}}.
                                </p>
                            {% endif %}
                            <div class="centered-div" style="margin: 2rem 0rem;">
                                {% if event.shotgun %}
                                    <a href="{% url 'news:shotgun_detail' event.shotgun.pk%}" class="button blue-button">Voir le shotgun</a>
                                {% else %}
                                    {% if student in event.participants.all %}
                                        <a href="{% url 'news:event_participate' event_id=event.id action='Unparticipate'%}" class="button red-button">Je ne participe plus</a>
                                    {% else %}
                                        <a href="{% url 'news:event_participate' event_id=event.id action='Participate'%}" class="button blue-button">Je participe</a>
                                    {% endif %}
                                {% endif %}
                                <a href="{% url 'news:events' %}" class="button green-button">Retour à l'index</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-12">
                        {% if event.shotgun %}
                            {% if event.shotgun.requires_motivation and not event.shotgun.motivations_review_finished %}
                                <p>Les participations acceptées ne sont pas disponibles pour le moment.</p>
                            {% else %}
                                <h5>Participations acceptées :</h5>
                                {% for participation in event.shotgun.accepted_participations %}
                                    <div class="col-xxl-2 col-xl-3 col-lg-4 col-sm-6">
                                        <div class="user-card">
                                            <div class="user-image"><img src="{% if participation.participant.picture %}{{participation.participant.picture.url}}{% else %}https://i.imgur.com/hczKIze.jpg{% endif %}" alt=""></div>
                                            <div class="user-information">
                                                <span class="user-name">{{participation.participant.user.first_name}} {{participation.participant.user.last_name}}</span>
                                            </div>
                                        </div>
                                    </div>
                                {% empty %}
                                    <h5>Personne n'a réussi ce shotgun pour le moment.</h5>
                                {% endfor %}
                            {% endif %}
                        {% else %}
                            {% if event.participants.all %}
                                <br><br>
                                <h3>Participants</h3>
                                {% for participant in event.participants.all %}
                                    <div class="col-xxl-2 col-xl-3 col-lg-4 col-sm-6">
                                        <div class="user-card">
                                            <div class="user-image"><img src="{% if participant.picture %}{{participant.picture.url}}{% else %}https://i.imgur.com/hczKIze.jpg{% endif %}" alt=""></div>
                                            <div class="user-information">
                                                <span class="user-name">{{participant.user.first_name}} {{participant.user.last_name}}</span>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            {% else %}
                                <br><br>
                                <h4>Cet évènement n'a pas encore d'inscrits :(</h4>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
