{% load static %}
<!doctype html>
<html>
    <!--Header-->
    <head>
        <meta charset='utf-8'>
        <title>Index</title>
        <!--Style-->
        <link rel="stylesheet" href="{% static 'css/styles.css' %}">
        <link rel="stylesheet" href="{% static 'css/bootstrap.css' %}">
        <link rel="stylesheet" href="{% static 'css/flickity.css' %}">
        <script src="https://kit.fontawesome.com/e89ead331b.js" crossorigin="anonymous"></script>
    </head>
    <body>
        <!--Sidenav-->
        <div class="sidenav-container">
            <nav class="sidenav">
                <div class="sidenav-first-link">
                    <a href=""><img src="{% static 'assets/img/logo.png' %}" class="logo" alt=""></a>
                    <div class="toggle "><i class="fas fa-bars "></i></div>
                </div>
                <div class="sidenav-links">
                    <a href="#" class="sidenav-link {% if active_link == 'news' %} active {% endif %}"><i class="fas fa-newspaper "></i></a>
                    <a href="/social/index_users" class="sidenav-link {% if active_link  == 'users' %} active {% endif %}"><i class="fas fa-user-graduate "></i></a>
                    <a href="#" class="sidenav-link {% if active_link == 'clubs' %} active {% endif %}"><i class="fas fa-gamepad "></i></a>
                    <a href="#" class="sidenav-link {% if active_link == 'resources' %} active {% endif %}"><i class="fas fa-file-alt "></i></a>
                    <a href="/social/index_profile" class="sidenav-link {% if active_link == 'profile' %} active {% endif %}"><i class="fas fa-address-card "></i></a>
                    <a href="#" class="sidenav-link {% if active_link == 'admin' %} active {% endif %}"><i class="fas fa-user-edit "></i></a>
                </div>
                <a href="#" class="sidenav-last-link sidenav-link {% if active_link == 'log-out' %} active {% endif %}"><i class="fas fa-sign-out-alt "></i></a>
            </nav>
        </div>
        <div class="content">
            <div class="content-header">
                <div class="row justify-content-between w-100">
                    <div class="col">
                        <div class="search-input-group">
                            <input type="text" class="search-input" placeholder="Rechercher">
                            <button class="button search-button"><i class="fas fa-search "></i></button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="content-main">
                <h3 class="page-title">News</h3>
                <br>
                <div style="text-align:center">
                    <a href="{% url 'news:post_create' %}"><i class="fas fa-plus-circle fa-5x"></i></a>
                </div>
                {% for post, form in all_posts_and_forms %}
                    <div class="news-card" id="{{post.id}}">
                        <div class="news-card-header">
                            <!--Poster-Image-Name-and-Title-of-the-post-->
                            {% if post.club %}
                                {% if post.club.logo %}
                                    <div class="news-card-header-image"><img src="{{post.club.logo.path}}"></div>
                                {% endif %}
                            {% else %}
                                {% if post.author.picture %}
                                    <div class="news-card-header-image"><img src="{{post.author.picture.path}}"></div>
                                {% endif %}
                            {% endif %}
                            <div class="news-card-header-text">
                                <span class="news-card-header-name">
                                    {%if post.club%}
                                        {{post.club.name}}
                                    {%else%}
                                        {{post.author.user.first_name}} {{post.author.user.last_name}}
                                    {%endif%}
                                </span>
                                {% if post.event %}
                                    <a href="{% url 'news:event_detail' post.event.pk %}" class="news-card-header-title">{{post.title}}</a>
                                {% else %}
                                    <span class="news-card-header-title">{{post.title}}</span>
                                {% endif %}
                            </div>
                            {% if post in my_posts %}
                                <a href="{% url 'news:post_edit' post.id %}" class="button blue-button">Ã‰diter</a>
                            {% endif %}
                        </div>
                        <div class="news-card-content">
                            <p>{{post.content}}</p>
                        </div>
                        {%if post.illustration%}
                            <div class="news-card-images">
                                <!--All-Images-Linked-With-The-Post-->
                                <div class="news-card-carousel" data-flickity='{}'>
                                    <div class="carousel-cell"><img src="{{post.illustration.path}}" style="height: 100%;" alt=""></div>
                                </div>
                            </div>
                        {%endif%}
                        <div class="news-card-actions">
                            <!--Likes-Comments-Favorite-->
                            <div class="news-card-buttons">
                                {% if user.student in post.likes.all  %}
                                    <a href="{% url 'news:post_like' post_id=post.id action='Dislike'%}" class="news-card-button"><i class="fas fa-heart"></i></a>
                                {% else %}
                                    <a href="{% url 'news:post_like' post_id=post.id action='Like'%}" class="news-card-button"><i class="far fa-heart"></i></a>
                                {% endif %}
                            </div>
                            <div class="news-card-popularity">
                                <span><i class="fas fa-heart" style="color: red;"></i> {{post.total_likes}}</span>
                                <span><i class="fas fa-comment" style="color: rgb(0, 153, 255);"></i> {{ post.total_comments }}</span>
                            </div>
                        </div>
                        <div class="news-card-comments" style="display: block">
                        {% for comment in post.comments.all %}
                            <div class="news-card-comments">
                                <div class="news-card-comment">
                                    {% if comment.club %}
                                        {% if comment.club.logo %}
                                            <div class="news-card-comment-user-pic"><img src="{{comment.club.logo.path}}"></div>
                                        {% else %}
                                            <div class="news-card-comment-user-pic"><img src="{% static 'assets/img/user.jpeg' %}" alt=""></div>
                                        {% endif %}
                                    {% else %}
                                        {% if comment.author.picture %}
                                            <div class="news-card-comment-user-pic"><img src="{{comment.author.picture.path}}"></div>
                                        {% else %}
                                            <div class="news-card-comment-user-pic"><img src="{% static 'assets/img/user.jpeg' %}" alt=""></div>
                                        {% endif %}
                                    {% endif %}
                                    <div class="news-card-comment-box"> {{ comment.content }} </div>
                                    {% if comment in my_comments %}
                                        <a href={% url 'news:comment_delete' comment_id=comment.id post_id=post.id %}><i class="fas fa-times-circle"></i></a>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                            <!-- comment form -->
                            <form method="post" >
                            {% csrf_token %}
                                <div class="news-card-edit-comment">
                                    <table>
                                        <tr>
                                            <td>
                                                {% if user.student.picture %}
                                                    <div class="news-card-comment-user-pic"><img src="{{user.student.picture.path}}"></div>
                                                {% else %}
                                                    <div class="news-card-comment-user-pic"><img src="{% static 'assets/img/user.jpeg' %}" alt=""></div>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                {{ form.club }}
                                            </td>
                                        </tr>
                                    </table>
                                    <textarea class="news-card-edit-comment-input" type="text" name="content" id=""></textarea>
                                    <button type="submit" class="news-card-button"><i class="far fa-comment"></i></button>
                                    {{ form.post.as_hidden }}
                                    {% if form.errors %}
                                        {% for field in form %}
                                            {% for error in field.errors %}
                                                <div class="login-errors">{{ error|escape }}</div>
                                            {% endfor %}
                                        {% endfor %}

                                        {% for error in form.non_field_errors %}
                                            <div class="login-errors">{{ error|escape }}</div>
                                        {% endfor %}
                                    {% endif %}
                                </div>
                            </form>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        <script src="{% static 'js/sidenav.js' %}"></script>
        <script src="{% static 'js/flickity.pkgd.min.js' %}"></script>
    </body>
</html>